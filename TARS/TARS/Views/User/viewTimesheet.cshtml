@model IEnumerable<TARS.Models.Hours>

@{
    ViewBag.Title = "viewTimesheet";
}

<h2>My Timesheet for @ViewBag.timesheet.periodStart.ToShortDateString() - @ViewBag.timesheet.periodEnd.ToShortDateString()</h2>
<h3>
    @if (ViewBag.timesheet.locked)
    {
        <i>(locked)</i>
    }
    else if (ViewBag.timesheet.submitted)
    {
        if (ViewBag.timesheet.approved)
        {
            <i>(approved)</i> 
        }
        else
        {
            <i>(submitted)</i> 
        }
    }
    else
    {
        <i>(not submitted)</i>
    }
</h3>


<div id="menu" style="float:right;">
    <h4>Actions</h4>
    @if (ViewBag.timesheet.locked == false)
    {       
        if (ViewBag.timesheet.approved == false)
        {
            <p>@Html.ActionLink("Add New Hours", "addHours")</p> 
            if (ViewBag.timesheet.submitted == false)
            {
                <p>@Html.ActionLink("Copy Previous Timesheet", "copyTimesheet")</p>
                <p>@Html.ActionLink("Submit Timesheet", "submitTimesheet", new { id = (int)ViewBag.timesheet.ID })</p>
            }
        }
    }
    
    @if (ViewBag.noPreviousTimesheet != true)
    {
        <p>@Html.ActionLink("View Previous Timesheet", "viewTimesheet",
                            new { tsDate = (DateTime)ViewBag.timesheet.periodStart.AddDays(-1) }, null)</p>
    }
    <!-- If the user isn't viewing their current timesheet -->
    @if ( (DateTime.Now < ViewBag.timesheet.periodStart)||(DateTime.Now > ViewBag.timesheet.periodEnd) )
    {
        <p>@Html.ActionLink("Back to Current Timesheet", "viewTimesheet", new { tsDate = DateTime.Now }, null)</p>
    }
    
</div>


<div id="content" style="float:left;">
@if (this.User.Identity.Name.Trim().Length == 0)
{
    <h3><i>(Not Logged In)</i></h3>
}

<table class="timesheet">
    <tr>
        <th>
            WorkEffort
        </th>
        <th>
            Hours
        </th>
        <th>
            HoursDescription
        </th>
        <th>
            Date
        </th>
        <th>
            Creator
        </th>
        <th></th>
    </tr>

@if (Model != null)
{
    foreach (var item in Model)
    {
    <tr>
        <td>
            @Html.Action("getWeDescription", "User", new { id = item.workEffortID })
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.hours)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.description)
        </td>
        <td>
            @item.timestamp.ToShortDateString()
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.creator)
        </td>

       @if ((ViewBag.timesheet.approved == false) && (ViewBag.timesheet.locked == false))
       {
            <td>
                @Html.ActionLink("Edit", "editHours", new { id = item.ID }) |
                @Html.ActionLink("Delete", "deleteHours", new { id = item.ID })
            </td>
       }
    </tr>
    }
}
</table>


</div>